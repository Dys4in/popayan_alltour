{% load static %}

<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel Empresarial Premium</title>
  <script src="{% static 'js/vistaempre.js' %}" defer></script>
  <link rel="stylesheet" href="{% static 'css/vistasEmpresario/vistaEmpresario.css' %}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>

<body>

  <nav class="navbar" id="navbar">
    <a href="#" class="logo-nav">
      <img src="{% static 'img/home/logo.png' %}" alt="PopayÃ¡n Tour Logo">
    </a>
    <div class="nav-actions">
      <div class="nav-icons">
        <div class="user-menu">
          <i class="fas fa-user" id="userIcon" aria-haspopup="true" aria-expanded="false"></i>
          <div class="dropdown" id="dropdownMenu">
            <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Cerrar SesiÃ³n</a>
          </div>
        </div>
      </div>
      <div class="hamburger" id="hamburger">
        <i class="fas fa-bars"></i>
      </div>
    </div>
  </nav>


  <div id="logoutModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" data-close="logout">&times;</span>
      <h3>Â¿Cerrar SesiÃ³n?</h3>
      <p>Â¿EstÃ¡s seguro de que quieres cerrar tu sesiÃ³n?</p>
      <div class="modal-actions">
        <button id="cancelLogout" class="btn btn-secondary">Cancelar</button>

        <!-- ğŸ” Cerrar sesiÃ³n por POST con CSRF -->
        <form method="post" action="{% url 'logout' %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-delete">SÃ­, salir</button>
        </form>
      </div>
    </div>
  </div>

  <div class="bg-animation"></div>

  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-content">
      <h1>Panel Empresarial</h1>
      <p>Bienvenido <span>{{ usuario.nombre_completo }}</span>, aquÃ­ puedes gestionar fÃ¡cilmente tus establecimientos y
        fortalecer tu conexiÃ³n con visitantes y turistas.</p>
    </div>
  </section>

  <!-- Main Content -->
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">{{ titulo }}</h2>
      <a href="{% url 'agregar_establecimiento' tipo_establecimiento %}" class="add-btn">
        <i class="fas fa-plus"></i>
        Agregar {{ tipo_establecimiento|title }}
      </a>

    </div>
  </div>

{% if establecimientos %}
  <div class="establecimientos-grid">
    {% for item in establecimientos %}
      <div class="establecimiento-card">
        <div class="establecimiento-image">
          {% if item.imagen %}
            <img src="{{ item.imagen.url }}" alt="{{ item.nombre }}">
          {% else %}
            <img src="{% static 'img/default.jpg' %}" alt="Sin imagen">
          {% endif %}
        </div>
        <div class="establecimiento-info">
          <h3>{{ item.nombre }}</h3>
          <p>{{ item.descripcion|truncatewords:15 }}</p>
          <div class="establecimiento-actions">
            <a href="{{ item.url_mas_info }}" target="_blank" class="btn btn-link">
              <i class="fas fa-external-link-alt"></i>
            </a>
            <!-- âœ… BotÃ³n de editar con URL correcta -->
            <a href="{% url 'editar_establecimiento' tipo=tipo_establecimiento id=item.id %}" class="btn btn-edit">
              <i class="fas fa-edit"></i>
            </a>
            <!-- âœ… BotÃ³n de eliminar que abre el modal -->
            <button type="button" 
                    class="btn btn-delete delete-trigger" 
                    data-id="{{ item.id }}" 
                    data-name="{{ item.nombre }}"
                    data-tipo="{{ tipo_establecimiento }}">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <p class="no-hoteles">No tienes {{ tipo_establecimiento }}s registrados aÃºn.</p>
{% endif %}


<!-- âœ… Modal de confirmaciÃ³n para eliminar (ACTUALIZADO) -->
<div id="deleteModal" class="modal" style="display: none;">
  <div class="modal-content">
    <span class="close" data-close="delete">&times;</span>
    <h3>Confirmar EliminaciÃ³n</h3>
    <p>Â¿EstÃ¡s seguro de que deseas eliminar <strong id="hotelName"></strong>?</p>
    <p><strong>Esta acciÃ³n no se puede deshacer.</strong></p>
    <div class="modal-actions">
      <button id="cancelDelete" class="btn btn-secondary">Cancelar</button>
      <form id="deleteForm" method="post" style="display: inline;">
        {% csrf_token %}
        <button type="submit" class="btn btn-delete">SÃ­, Eliminar</button>
      </form>
    </div>
  </div>
</div>

</body>

</html>