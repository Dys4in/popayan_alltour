{% load static %}

<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel Empresarial Premium</title>
  <script src="{% static 'js/vistaempre.js' %}" defer></script>
  <link rel="stylesheet" href="{% static 'css/vistasEmpresario/vistaEmpresario.css' %}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>

<body>

  <nav class="navbar" id="navbar">
    <a href="#" class="logo-nav">
      <img src="{% static 'img/home/logo.png' %}" alt="Popayán Tour Logo">
    </a>
    <div class="nav-actions">
      <div class="nav-icons">
        <!-- ✅ NUEVO: Botón para ir al Home -->
        <a href="{% url 'home' %}" class="nav-icon" title="Ir al Sitio Público" style="margin-right: 15px;">
          <i class="fas fa-home"></i>
        </a>
        
        <div class="user-menu">
          <i class="fas fa-user" id="userIcon" aria-haspopup="true" aria-expanded="false"></i>
          <div class="dropdown" id="dropdownMenu">
            <a href="#" id="logoutBtn"><i class="fas fa-user-edit"></i> Editar Perfil</a>
          </div>
        </div>
      </div>
      <div class="hamburger" id="hamburger">
        <i class="fas fa-bars"></i>
      </div>
    </div>
  </nav>

  <!-- Modal de Editar Perfil -->
  <div id="logoutModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" data-close="logout">&times;</span>
      <h3>Editar Perfil</h3>
      <p>¿Deseas ir a editar tu perfil?</p>
      <div class="modal-actions">
        <button id="cancelLogout" class="btn btn-secondary">Cancelar</button>
        <a href="{% url 'perfilUser' %}" class="btn btn-primary">
          <i class="fas fa-user-edit"></i> Ir al Perfil
        </a>
      </div>
    </div>
  </div>

  <div class="bg-animation"></div>

  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-content">
      <h1>Panel Empresarial</h1>
      <p>Bienvenido <span>{{ usuario.nombre_completo }}</span>, aquí puedes gestionar fácilmente tus establecimientos y
        fortalecer tu conexión con visitantes y turistas.</p>
    </div>
  </section>

<!--    Main Content 
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">{{ titulo }} Activos</h2>
      <a href="{% url 'agregar_establecimiento' tipo_establecimiento %}" class="add-btn">
        <i class="fas fa-plus"></i>
        Agregar {{ tipo_establecimiento|title }}
      </a>
    </div>
  </div> 
-->

  <!-- Agregar después del botón "Agregar" -->
<!-- DESPUÉS del botón de "Agregar" -->
<div class="container">
    <div class="section-header">
        <h2 class="section-title">{{ titulo }} Activos</h2>
        <div style="display: flex; gap: 10px;">
            <a href="{% url 'agregar_establecimiento' tipo_establecimiento %}" class="add-btn">
                <i class="fas fa-plus"></i>
                Agregar {{ tipo_establecimiento|title }}
            </a>
        </div>
    </div>
</div>


  <!-- ✅ ESTABLECIMIENTOS ACTIVOS -->
  {% if establecimientos_activos %}
    <div class="establecimientos-grid">
      {% for item in establecimientos_activos %}
        <div class="establecimiento-card">
          <div class="establecimiento-image">
            {% if item.imagen %}
              <img src="{{ item.imagen.url }}" alt="{{ item.nombre }}">
            {% else %}
              <img src="{% static 'img/default.jpg' %}" alt="Sin imagen">
            {% endif %}
          </div>
          <div class="establecimiento-info">
            <h3>{{ item.nombre }}</h3>
            <p>{{ item.descripcion|truncatewords:15 }}</p>
            <div class="establecimiento-actions">
              <!-- ✅ NUEVO: Botón para ver en el sitio público -->
              {% if tipo_establecimiento == 'hotel' %}
                <a href="{% url 'listar_hoteles' %}#establecimiento-{{ item.id }}" target="_blank" class="btn btn-view" title="Ver en sitio público">
                  <i class="fas fa-eye"></i>
                </a>
              {% elif tipo_establecimiento == 'restaurante' %}
                <a href="{% url 'listar_restaurantes' %}#establecimiento-{{ item.id }}" target="_blank" class="btn btn-view" title="Ver en sitio público">
                  <i class="fas fa-eye"></i>
                </a>
              {% elif tipo_establecimiento == 'museo' %}
                <a href="{% url 'listar_museos' %}#establecimiento-{{ item.id }}" target="_blank" class="btn btn-view" title="Ver en sitio público">
                  <i class="fas fa-eye"></i>
                </a>
              {% elif tipo_establecimiento == 'iglesia' %}
                <a href="{% url 'listar_iglesias' %}#establecimiento-{{ item.id }}" target="_blank" class="btn btn-view" title="Ver en sitio público">
                  <i class="fas fa-eye"></i>
                </a>
              {% endif %}
              
              <a href="{{ item.url_mas_info }}" target="_blank" class="btn btn-link">
                <i class="fas fa-external-link-alt"></i>
              </a>
              <a href="{% url 'editar_establecimiento' tipo=tipo_establecimiento id=item.id %}" class="btn btn-edit">
                <i class="fas fa-edit"></i>
              </a>
              <button type="button" 
                      class="btn btn-delete delete-trigger" 
                      data-id="{{ item.id }}" 
                      data-name="{{ item.nombre }}"
                      data-tipo="{{ tipo_establecimiento }}">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="no-hoteles">No tienes {{ tipo_establecimiento }}s activos registrados aún.</p>
  {% endif %}

  <!-- ✅ ESTABLECIMIENTOS INACTIVOS -->
  {% if establecimientos_inactivos %}
    <div class="container" style="margin-top: 60px;">
      <div class="section-header">
        <h2 class="section-title">{{ titulo }} Desactivados</h2>
      </div>
    </div>

    <div class="establecimientos-grid">
      {% for item in establecimientos_inactivos %}
        <div class="establecimiento-card inactive-card">
          <!-- ✅ Badge de desactivado -->
          <div class="inactive-badge">
            <i class="fas fa-eye-slash"></i> Desactivado
          </div>
          
          <div class="establecimiento-image grayscale">
            {% if item.imagen %}
              <img src="{{ item.imagen.url }}" alt="{{ item.nombre }}">
            {% else %}
              <img src="{% static 'img/default.jpg' %}" alt="Sin imagen">
            {% endif %}
            <!-- ✅ Overlay de inactivo -->
            <div class="inactive-overlay">
              <i class="fas fa-ban"></i>
            </div>
          </div>
          
          <div class="establecimiento-info">
            <h3 style="opacity: 0.6;">{{ item.nombre }}</h3>
            <p style="opacity: 0.6;">{{ item.descripcion|truncatewords:15 }}</p>
            <div class="establecimiento-actions inactive-actions">
              <!-- ✅ Botón de reactivar -->
              <button type="button" 
                      class="btn btn-success reactivate-trigger" 
                      data-id="{{ item.id }}" 
                      data-name="{{ item.nombre }}"
                      data-tipo="{{ tipo_establecimiento }}"
                      title="Reactivar">
                <i class="fas fa-check-circle"></i> Reactivar
              </button>
              
              <!-- ✅ Botón de eliminar permanentemente -->
              <button type="button" 
                      class="btn btn-danger-permanent permanent-delete-trigger" 
                      data-id="{{ item.id }}" 
                      data-name="{{ item.nombre }}"
                      data-tipo="{{ tipo_establecimiento }}"
                      title="Eliminar Permanentemente">
                <i class="fas fa-trash-alt"></i> Eliminar
              </button>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- Modal de confirmación para desactivar -->
  <div id="deleteModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" data-close="delete">&times;</span>
      <h3>Confirmar Desactivación</h3>
      <p>¿Estás seguro de que deseas desactivar <strong id="hotelName"></strong>?</p>
      <p><strong>Este establecimiento dejará de aparecer en las listas públicas, pero podrás reactivarlo más tarde si lo necesitas.</strong></p>
      <div class="modal-actions">
        <button id="cancelDelete" class="btn btn-secondary">Cancelar</button>
        <form id="deleteForm" method="post" style="display: inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn-delete">Sí, Desactivar</button>
        </form>
      </div>
    </div>
  </div>

  <!-- ✅ Modal de confirmación para reactivar -->
  <div id="reactivateModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" data-close="reactivate">&times;</span>
      <h3>Confirmar Reactivación</h3>
      <p>¿Deseas reactivar <strong id="reactivateName"></strong>?</p>
      <p>El establecimiento volverá a aparecer en las listas públicas.</p>
      <div class="modal-actions">
        <button id="cancelReactivate" class="btn btn-secondary">Cancelar</button>
        <form id="reactivateForm" method="post" style="display: inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn-success">Sí, Reactivar</button>
        </form>
      </div>
    </div>
  </div>

  <!-- ✅ Modal de ELIMINACIÓN PERMANENTE -->
  <div id="permanentDeleteModal" class="modal" style="display: none;">
    <div class="modal-content danger-modal">
      <span class="close" data-close="permanent">&times;</span>
      <h3 style="color: #dc3545;">⚠️ ELIMINAR PERMANENTEMENTE</h3>
      <p>¿Estás seguro de que deseas eliminar <strong id="permanentDeleteName"></strong> de forma permanente?</p>
      <div class="warning-box">
        <p><strong>¡ADVERTENCIA!</strong> Esta acción NO se puede deshacer.</p>
        <p>Todos los datos de este establecimiento se eliminarán completamente de la base de datos.</p>
      </div>
      <div class="modal-actions">
        <button id="cancelPermanentDelete" class="btn btn-secondary">Cancelar</button>
        <form id="permanentDeleteForm" method="post" style="display: inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger-permanent">
            <i class="fas fa-trash-alt"></i> Sí, Eliminar Permanentemente
          </button>
        </form>
      </div>
    </div>
  </div>

<!-- ✅ NUEVA SECCIÓN: Resumen de Estadísticas -->
{% if estadisticas %}
<div class="container" style="margin-top: 40px; margin-bottom: 40px;">
    <div class="stats-summary-card">
        <div class="stats-header-section">
            <i class="fas fa-chart-line stats-icon"></i>
            <h2>Estadísticas de Visitas</h2>
        </div>
        
        <div class="total-visits-banner">
            <div class="total-number">{{ total_visitas }}</div>
            <div class="total-label">Visitas Totales Acumuladas</div>
        </div>

        <div class="stats-cards-grid">
            {% for stat in estadisticas %}
            <div class="mini-stat-card">
                <div class="stat-card-header-mini">
                    <h4>{{ stat.establecimiento.nombre }}</h4>
                </div>
                <div class="stat-numbers-row">
                    <div class="stat-item">
                        <span class="stat-value">{{ stat.visitas_totales }}</span>
                        <span class="stat-label">Total</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">{{ stat.visitas_mes }}</span>
                        <span class="stat-label">Mes</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">{{ stat.visitas_semana }}</span>
                        <span class="stat-label">Semana</span>
                    </div>
                </div>
                
                <!-- ✅ NUEVO: Mostrar visitas registradas vs anónimas -->
                <div class="user-type-stats">
                    <div class="user-stat registered">
                        <i class="fas fa-user-check"></i>
                        <span>{{ stat.visitas_registradas }} registrados</span>
                    </div>
                    <div class="user-stat anonymous">
                        <i class="fas fa-user-secret"></i>
                        <span>{{ stat.visitas_anonimas }} anónimos</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

<div class="container" style="margin-top: 20px; margin-bottom: 40px;">
    <div class="export-section">
        <h3 style="color: #333; margin-bottom: 15px;">
            <i class="fas fa-download"></i> Exportar Estadísticas
        </h3>
        <p style="color: #666; margin-bottom: 20px;">
            Descarga tus estadísticas en formato PDF o Excel
        </p>
        <div class="export-buttons">
            <a href="{% url 'exportar_empresario_pdf' %}" class="export-btn pdf-btn">
                <i class="fas fa-file-pdf"></i>
                Descargar PDF
            </a>
            <a href="{% url 'exportar_empresario_excel' %}" class="export-btn excel-btn">
                <i class="fas fa-file-excel"></i>
                Descargar Excel
            </a>
        </div>
    </div>
</div>

<style>
.export-section {
    background: white;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    text-align: center;
}

.export-buttons {
    display: flex;
    gap: 20px;
    justify-content: center;
    flex-wrap: wrap;
}

.export-btn {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 15px 30px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    font-size: 1rem;
    transition: all 0.3s ease;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.export-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.15);
}

.pdf-btn {
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    color: white;
}

.pdf-btn:hover {
    background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
}

.excel-btn {
    background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
    color: white;
}

.excel-btn:hover {
    background: linear-gradient(135deg, #229954 0%, #1e8449 100%);
}

@media (max-width: 768px) {
    .export-buttons {
        flex-direction: column;
    }
    
    .export-btn {
        width: 100%;
        justify-content: center;
    }
}
</style>



  <style>
    /* ✅ Estilos para el botón de ver en sitio público */
    .btn-view {
      background: #17a2b8;
      color: white;
      padding: 8px 12px;
      border-radius: 5px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    
    .btn-view:hover {
      background: #138496;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(23, 162, 184, 0.3);
    }
    
    /* Estilo para el ícono de home en el navbar */
    .nav-icon {
      color: white;
      font-size: 1.2rem;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    
    .nav-icon:hover {
      color: #17a2b8;
      transform: scale(1.1);
    }

    /* ✅ Estilo para el botón de ir al perfil */
    .btn-primary {
      background: #007bff;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
    }
    
    .btn-primary:hover {
      background: #0056b3;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
    }
  </style>

</body>

</html>